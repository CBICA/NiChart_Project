name: nichart_dlwmls_v2
description: This tool segments white matter lesions on FLAIR MRI brain scans while also using T1-DLMUSE to produce regional lesion volumes.

dependencies: # Names of dependencies. To make another tool's output a dependency, place its name in this list
  - t1_img
  - fl_img
  - dlmuse_seg

inputs:
  fl_img:
    type: directory
  t1_img:
    type: directory
  dlmuse_seg:
    type: directory
  demog_csv:
    type: file

outputs:
  nichart_dlwmls_out:
    type: directory

mounts:
  fl_img:
    path_in_container: /input/fl
    mode: ro
  t1_img:
    path_in_container: /input/t1
    mode: ro
  dlmuse_seg:
    path_in_container: /input/dlmuse_seg
    mode: ro
  demog_csv:
    path_in_container: /input/demog.csv
    mode: ro
  nichart_dlwmls_out:
    path_in_container: /output/nichart_dlwmls_out
    mode: rw

parameters:
  {} # Empty dictionary to signify no parameters

resources: # Used to allocate jobs on the cloud. Please be diligent.
  vcpus: 4
  memory: 28000 # Amount must be in MiB, see https://docs.aws.amazon.com/batch/latest/APIReference/API_ResourceRequirement.html
  gpus: 1

container:
  image: cbica/nichart_dlwmls:0.0.3
  command: --list {demog_csv} --fl_dir {fl_img} --t1_dir {t1_img} --dlmuse_dir {dlmuse_seg} --out_dir {nichart_dlwmls_out} --device cuda --named-headers
