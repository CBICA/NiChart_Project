pipeline_name: SPARE Scores - Diabetes (Unharmonized)
description: |
  Pipeline which uses DLMUSE and DLWMLS to produce SPARE classification of Diabetes.

categories:
  - spare
  - inference
  - classification
  - diabetes

requires:
  - needs_T1
  - needs_FLAIR
  - needs_demographics
  - csv_has_columns: [MRID, Age, Sex]

steps:
  - id: run_dlmuse
    tool: nichart_dlmuse
    inputs:
      t1_img: ${STUDY}/t1
    outputs:
      dlmuse_seg: ${STUDY}/dlmuse_seg
      dlmuse_vol: ${STUDY}/dlmuse_vol

  - id: run_nichart_dlwmls
    tool: nichart_dlwmls_v2 # MUST CORRESPOND EXACTLY to a tool in resources/tools dir
    inputs:
      t1_img: ${STUDY}/t1
      fl_img: ${STUDY}/fl
      dlmuse_seg: ${STUDY}/dlmuse_seg
      demog_csv: ${STUDY}/participants/participants.csv

    outputs:
      nichart_dlwmls_out: ${STUDY}/nichart_dlwmls_out
  - id: merge_feature_csvs
    tool: merge_feature_csvs_by_mrid
    inputs:
      csv_1: ${STUDY}/dlmuse_vol/DLMUSE_Volumes.csv
      csv_2: ${STUDY}/nichart_dlwmls_out/DLWMLS_DLMUSE_Segmented_Volumes.csv
    outputs:
      out_csv: ${STUDY}/merged_dlmuse_dlwmls/csv_out.csv
  - id: run_spare_cvm_diabetes
    tool: spare_cvm_diabetes # MUST CORRESPOND EXACTLY to a tool in resources/tools dir
    inputs:
      merged_dlwmls_dlmuse_csv: ${STUDY}/merged_dlmuse_dlwmls/csv_out.csv
      demog_csv: ${STUDY}/participants/participants.csv
    outputs:
      spare_cvm_csv: ${STUDY}/ml_biomarkers/SPARE_DIABETES.csv
    